1
00:00:00,000 --> 00:00:06,486
Hey, my name is Milan, and in this video we're going to explore an interesting messaging library called Wolverine

2
00:00:06,634 --> 00:00:13,269
You may have already heard about it, might have never talked about it on my channel, and we're going to explore it in this video

3
00:00:13,482 --> 00:00:16,660
I wanted to talk about Wolverine for several reasons

4
00:00:16,560 --> 00:00:20,834
First, because it's a very interesting and powerful messaging library

5
00:00:20,734 --> 00:00:23,092
It's part of the broader creator stack

6
00:00:22,992 --> 00:00:28,497
We have another popular library called Martin, which I did talk about in a video a few years ago

7
00:00:28,398 --> 00:00:34,357
It allows you to treat postgress as a document database, and it also gives you support for event sourcing

8
00:00:34,257 --> 00:00:43,345
But let's go back to bullring, it became significantly more popular with mass transit going commercial as people were exploring other options, and I have to say

9
00:00:43,246 --> 00:00:49,638
That I haven't used Wolverine, so you're basically going to see my raw take as a beginner with this library

10
00:00:49,538 --> 00:00:53,456
And I think this perspective might be interesting to some of you

11
00:00:53,356 --> 00:00:56,921
Let me walk you through what I plan to build with Wolverine

12
00:00:56,821 --> 00:00:58,194
I'm basically going

13
00:00:58,094 --> 00:01:07,361
To step through, they're getting started example with just my own messages and handlers, and it's going to be a demo of using wolverine as a command bus

14
00:01:07,261 --> 00:01:10,490
And right now, all of this is going to work in memory

15
00:01:10,390 --> 00:01:13,110
What I already prepared behind the scenes

16
00:01:13,130 --> 00:01:17,398
IS A SIMPLE ASPIRE APPLICATION WITH A WEB API

17
00:01:17,482 --> 00:01:30,006
A POSTGRES DATABASE AND I CONFIGURED IF CORE AND SET UP MY DATABASE MIGRATIONS SO WHAT WE NEED TO DO TO GET STARTED WITH WOLVERINE IS INSTALL THE NEW GET PACKAGE I'M GOING TO LOOK FOR WOLVERINE

18
00:01:30,090 --> 00:01:35,574
And I'm going to install the latest version of Wolverine FX, so let's install that

19
00:01:35,658 --> 00:01:43,510
and then how you add it to your application is you go back to your program file and you can say builder and then host

20
00:01:43,530 --> 00:01:47,549
AND NOW YOU HAVE A NEW EXTENSION METHOD CALLED USE WOLVERINE

21
00:01:47,449 --> 00:01:50,777
SO THIS IS ALL THAT'S REQUIRED FOR THE BASIC SETUP

22
00:01:50,677 --> 00:01:54,390
OF COURSE YOU CAN CUSTOMIZE THIS AS WOLVERINE SUPPORTS

23
00:01:54,410 --> 00:02:01,558
Quite a bit of rich functionality among them support for many popular message transports including rabbit and mq

24
00:02:01,514 --> 00:02:03,115
Azure service bus and SQS

25
00:02:03,015 --> 00:02:09,191
Now I'm going to talk about those in a future video, but now let's keep the wolverine setup as simple as this

26
00:02:09,091 --> 00:02:10,898
So then the next thing we need

27
00:02:10,798 --> 00:02:24,210
There's a command and a respective handler, so this is going to be very similar to something that you're probably used to from Mediator, and I'm going to create a folder called Features, and inside of it I'll define a new folder for my new feature

28
00:02:24,110 --> 00:02:28,334
and let's say i just call this the register feature for lack of a better name

29
00:02:28,234 --> 00:02:30,102
now let me add a new class inside

30
00:02:30,122 --> 00:02:32,371
And this is going to be my first message

31
00:02:32,271 --> 00:02:36,735
So in this case, I am defining a command, and I am going to call this register user

32
00:02:36,635 --> 00:02:45,138
So let's make it a record, and I am going to define a couple of properties that I am going to need for my new user, and it is just going to be an email, a first name

33
00:02:45,038 --> 00:02:49,558
AND A LAST NAME, SO KEEPING IT SIMPLE, AND THIS REPRESENTS OUR MESSAGE CONTRACT

34
00:02:49,458 --> 00:02:53,782
IT DOESN'T MATTER IF YOU'RE USING THIS IN MEMORY OR WITH A MESSAGE TRANSPORT

35
00:02:53,802 --> 00:02:56,375
This is all it takes to define a message

36
00:02:56,275 --> 00:02:58,849
You don't need any specific interface

37
00:02:58,749 --> 00:03:02,821
You'll see that most things with Wolverine work by convention

38
00:03:02,721 --> 00:03:06,944
Now, some people may treat this as a dose of too much magic going on

39
00:03:06,844 --> 00:03:08,818
I certainly need one of those

40
00:03:08,718 --> 00:03:14,882
A bit more strict approach with more rules and abstractions, but I'm open to exploring something different

41
00:03:14,782 --> 00:03:20,214
So let's continue using the default approach, and how we define a handler is we just name a class

42
00:03:20,169 --> 00:03:23,470
WITH THE NAME OF OUR MESSAGE, AND THEN EXTEND THAT WITH HANDLER

43
00:03:23,370 --> 00:03:28,241
NOW YOU CAN USE DEPENDENCY INJECTION IN THIS CLASS AND EVEN USE PRIMARY CONSTRUCTORS FOR THIS

44
00:03:28,141 --> 00:03:35,186
SO LET ME INJECT AN APPLICATION DATABASE CONTEXT AND THIS IS GOING TO WORK, AND THEN TO DEFINE MY ACTUAL HANDLER LOGIC, I JUST NEED TO CREATE

45
00:03:35,086 --> 00:03:46,454
A method called handle the first argument needs to be the message type, so this is going to be register user and let's call this the command and I'm going to accept this completion from visual studio

46
00:03:46,538 --> 00:03:59,313
CREATING A NEW USER AND SETTING THE RESPECTIVE PROPERTIES, AND ADDITIONALLY I'M GOING TO DEFINE THE CREATED AD FIELD AND LET'S JUST SET THIS TO DATE TIME UTC NOW SINCE THE IDENTIFIER IS GOOD

47
00:03:59,214 --> 00:04:03,775
I'm going to say go with new good and create that, and this gives us our first entity

48
00:04:03,675 --> 00:04:08,948
So you can see I don't need to have any abstractions here, although there is a way to achieve this

49
00:04:08,848 --> 00:04:12,246
You can implement an interface that exposes a handle method

50
00:04:12,202 --> 00:04:15,075
OR YOU CAN DECORATE YOUR TYPE WITH AN ATTRIBUTE

51
00:04:14,975 --> 00:04:24,854
NOW LET'S CONTINUE USING THE CONVENTIONAL APPROACH, AND WE HAVE OUR HANDLER AND A MESSAGE, AND NOW ALL WE NEED TO DO IS EXPOSE AN API ENDPOINT THAT WE CAN CALL SAUCY APP MAP

52
00:04:24,810 --> 00:04:39,826
POST I'LL USE MINIMAL APIS LET'S SAY THE ROUTE IS JUST USERS AND THE REQUEST ARGUMENT IS GOING TO BE THE REGISTER USER COMMAND I'LL CALL IT A COMMAND AND THEN HERE'S HOW YOU INTERACT WITH WOLVERINE THERE'S AN INTERFACE CALLED I MESSAGE BUS AND

53
00:04:39,726 --> 00:04:43,905
This allows you to call the respective methods that are available

54
00:04:43,805 --> 00:04:45,654
One of those is invoke async

55
00:04:45,610 --> 00:04:56,364
Where we can just pass our command, and this is going to hand off the execution to the Wolverine pipeline is going to find and execute our handler, and then we're going to return the response from our API endpoint

56
00:04:56,264 --> 00:04:58,129
So let's go ahead and test this out

57
00:04:58,029 --> 00:05:00,017
I'm going to start this application

58
00:04:59,917 --> 00:05:00,626
You'll see

59
00:05:00,526 --> 00:05:07,606
See the Aspire dashboard and application getting started and I'm going to open up the scaler UI that contains my endpoint

60
00:05:07,690 --> 00:05:09,874
HERE'S THE ONE ENDPOINT THAT I HAVE

61
00:05:09,774 --> 00:05:11,958
I'M GOING TO GO AHEAD AND TEST IT OUT

62
00:05:12,106 --> 00:05:15,051
And let's give this dummy email, let's say test at test

63
00:05:14,951 --> 00:05:20,434
com, and the first name and last name I'm going to have the same values, and I'm going to send this request

64
00:05:20,334 --> 00:05:26,930
And you can see that we had a breakpoint in our minimal API endpoint, and if I hit continue, this will be handed off to Wolverine

65
00:05:26,830 --> 00:05:29,608
IS GOING TO INVOKE MY REGISTER USER HANDLER

66
00:05:29,508 --> 00:05:34,677
NOTICE THAT THE DATABASE CONTEXT IS PROPERLY INJECTED FROM DEPENDENCY INJECTION

67
00:05:34,577 --> 00:05:39,094
I CAN GO AHEAD AND CREATE MY USER AND PERSIST THIS TO MY POSTGRES DATABASE

68
00:05:39,050 --> 00:05:43,339
AND IF I HIT CONTINUE, I'LL GET A TWO HUNDRED OK RESPONSE BACK IN SCALAR

69
00:05:43,238 --> 00:05:45,682
IF WE TAKE A LOOK AT C DISTRIBUTED TRACES

70
00:05:45,582 --> 00:05:51,007
YOU CAN SEE WE HAVE TWO SPANS IN THE STRAYS, OUR API CALL AND OUR SQL QUERY TO INSERT THE USER

71
00:05:50,907 --> 00:05:56,688
YOU CAN SEE IT TAKES A VERY MINIMAL AMOUNT OF CODE TO CREATE A FUNCTIONAL MESSAGING APPLICATION

72
00:05:56,588 --> 00:05:58,534
SO WHAT CAN WE DO NEXT FROM HERE?

73
00:05:58,434 --> 00:06:00,594
WELL, WOOVERING HAS THIS CONCEPT

74
00:06:00,494 --> 00:06:00,994
Except

75
00:06:01,002 --> 00:06:05,031
Of cascading messages, so let me go ahead and add a new class

76
00:06:04,931 --> 00:06:09,746
So let's say after we've created a user, we also want to publish an event

77
00:06:09,646 --> 00:06:12,387
THIS EVENT IS GOING TO BE CALLED USER REGISTERED

78
00:06:12,287 --> 00:06:17,091
LET'S ALSO MAKE IT A RECORD, AND I'M JUST GOING TO GIVE IT THE USER ID AS THE ONLY ARGUMENT

79
00:06:16,991 --> 00:06:19,282
NOW HOW YOU WOULD TYPICALLY PUBLISH THIS

80
00:06:19,182 --> 00:06:31,318
WITH SOME OTHER LIBRARIES, AS LET'S SAY MEDIATOR HAS THIS NOTIFICATION APPROACH, YOU WOULD NEED ACCESS TO THE I MEDIATOR OR I PUBLISHER INSTANCES, AND THEN MANUALLY CALL THE PUBLISHMENT WITH WOLVERINE

81
00:06:31,338 --> 00:06:39,253
What you can do is return an object or a message from this handle method, and in this case this will be user registered

82
00:06:39,402 --> 00:06:48,598
With the respective value, now I do have to update the signature here to also return the same type, and now this will be treated as a cascading message

83
00:06:48,618 --> 00:06:52,344
AND MOBILRING IS GOING TO PUBLISH IT AFTER THIS ONE COMPLETES

84
00:06:52,244 --> 00:06:58,201
NOW FOR THIS MESSAGE, I CAN ALSO CREATE A RESPECTIVE HAMMER, AND THE CONVENTION IS THE SAME AS BEFORE

85
00:06:58,101 --> 00:07:01,269
YOU USE THE MESSAGE NAME, SO LET'S SAY USER REGISTER

86
00:07:01,290 --> 00:07:02,858
And we append handler

87
00:07:02,758 --> 00:07:12,131
What's interesting is that this class can even be static, doesn't have to be a typical class, and inside of it I can define a static handle method

88
00:07:12,031 --> 00:07:15,221
So let's say public static, async task, handle

89
00:07:15,178 --> 00:07:25,782
WE HAVE TO ACCEPT OUR MESSAGE, SO LET'S SAY EVENT, AND THEN I'M GOING TO SAY AWAIT, TASK, DELAY, AND FOR EXAMPLE DELAY FOR A SECOND TO SIMULATE SOME MESSAGE PROCESSING

90
00:07:25,866 --> 00:07:30,205
So let's place a breakpoint here, and let's run the application again

91
00:07:30,105 --> 00:07:33,941
And from the scaler UI, I will go ahead and send my test request

92
00:07:33,841 --> 00:07:39,474
We again had our breakpoint inside of our minimal API endpoint, where I will press continue

93
00:07:39,374 --> 00:07:50,558
THE NEXT BREAK WHEN WE HIT IS INSIDE OUR HANDLE METHOD, WHERE WE GO THROUGH THE REGULAR FLOW, OPERATING AN ENTITY, ADDING IT TO OUR DATABASE CONTEXT, AND THEN PERSISTING EVERYTHING AFTER CALLING SAFE CHANGES

94
00:07:50,458 --> 00:07:52,406
SO THIS COMPLETES OUR NORMAL FLOW

95
00:07:52,362 --> 00:08:00,022
AND NOW WE WANT TO PUBLISH THIS USER REGISTER EVENT, SO IF I KEEP GOING AFTER THIS LINE, YOU'LL SEE THAT WE NOW HAD THE BREAK POINT

96
00:08:00,042 --> 00:08:04,950
In the user registered handler, and if we take a look at the object that we got

97
00:08:04,970 --> 00:08:07,951
It contains the identifier of our newly created user

98
00:08:07,851 --> 00:08:14,419
So now we could do something like set up their account, maybe create a new tenant for them or just send them a welcome email

99
00:08:14,319 --> 00:08:18,005
The options are limitless, but I wanted to highlight how easy it is

100
00:08:17,962 --> 00:08:22,394
To start building non-trivial messaging applications with Wolverine

101
00:08:22,294 --> 00:08:24,454
Now, this isn't a sponsored video

102
00:08:24,354 --> 00:08:29,852
I'm just a newbie exploring Wolverine, the same as some of you out there, and so far I like it

103
00:08:29,752 --> 00:08:32,977
Now, what I want to see next is how it integrates with

104
00:08:32,878 --> 00:08:35,734
my favorite message transport which is rabbitmq

105
00:08:35,690 --> 00:08:40,695
How it deals with the message topology, with the bindings and exchanges and cues

106
00:08:40,595 --> 00:08:42,715
That's a topic for another video

107
00:08:42,615 --> 00:08:48,413
One more thing I wanted to highlight about Wolverine is that they have amazing documentation

108
00:08:48,313 --> 00:08:49,784
It's full of examples

109
00:08:49,684 --> 00:08:50,577
It contains

110
00:08:50,477 --> 00:08:57,272
Everything you probably need to get started with using it, and they also have a nice community of folks who like using these libraries

111
00:08:57,172 --> 00:09:05,522
So I'm going to drop the link to this in the description of this video where you can learn more, and then stay tuned for more videos about Wolverine where we're going to

112
00:09:05,422 --> 00:09:13,443
Lord some advanced topics, what we covered so far works only in memory, so it's fairly limited for a serious production system

113
00:09:13,343 --> 00:09:18,225
But if you want to learn how to use RabbitMQ to build a messaging application

114
00:09:18,126 --> 00:09:20,266
Go ahead and watch this video next

115
00:09:20,166 --> 00:09:23,713
Let me know in the comments what you think about Wolverine

116
00:09:23,613 --> 00:09:29,482
Smash the like button for the YouTube algorithm so this gets recommended to more data developers

117
00:09:29,383 --> 00:09:32,438
Thanks a lot for watching and until next time stay

118
00:09:32,394 --> 00:09:33,207
AWESOME

